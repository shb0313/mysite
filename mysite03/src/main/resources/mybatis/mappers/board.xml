<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<resultMap id="findAllByPageAndKeywordList" type="boardvo">
		<id property="no" column="no"/>
		<result property="title" column="title"/>
		<result property="contents" column="contents"/>
		<result property="hit" column="hit"/>
		<result property="regDate" column="reg_date"/>
		<result property="gNo" column="g_no"/>
		<result property="oNo" column="o_no"/>
		<result property="userNo" column="user_no"/>
		<result property="userName" column="name"/>
	</resultMap>

	<select id="findAllByPageAndKeyword" 
			parameterType="boardvo"
			resultMap="findAllByPageAndKeywordList">
		<choose>
			<when test='keyword == null || keyword == ""'>
			<![CDATA[		
			select a.no, a.title, a.contents, a.hit, a.reg_date, a.g_no, a.o_no, a.depth, a.user_no, b.name 
				from board a, user b
    			where a.user_no = b.no
    			order by g_no desc, o_no desc
    			limit #{startOffset }, #{size }    
			]]>	
			</when>
			<otherwise>
			<![CDATA[		
			select a.no, a.title, a.contents, a.hit, a.reg_date, a.g_no, a.o_no, a.depth, a.user_no, b.name 
				from board a, user b
    			where a.user_no = b.no
					and title like '%${keyword }%'
					or contents like '%${keyword }%'
    			order by g_no desc, o_no desc
    			limit #{startOffset }, #{size }    
			]]>
			</otherwise>		
		</choose>
	</select>
	
	<select id="getTotalCount" parameterType="string" resultType="integer">
		<!-- 검색 값 유무 확인/ 있으면 검색 리스트 수, 없으면 전체 리스트 수 -->
		<choose>
			<when test='_parameter == null || _parameter == ""'>
				<![CDATA[
				select count(*)
				  from board
				]]>
			</when>
			<otherwise>
				<![CDATA[
				select count(*)
				  from board
				 where title like '%${_parameter }%'
				    or contents like '%${_parameter }%'
				]]>
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert" parameterType="boardvo">
		<![CDATA[
		insert into board 
			values(null, #{title }, #{contents }, 0, now(), (SELECT IFNULL(MAX(g_no) + 1, 1) FROM board a), 1, 0, #{userNo })
		]]>	
	</insert>
	
	
	
	
	
	
	
	
	
</mapper>